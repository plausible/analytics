<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.35.1">
    <meta name="project" content="Plausible v0.0.1">


    <title>mix create_paddle_prod_plans â€” Plausible v0.0.1</title>
    <link rel="stylesheet" href="dist/html-elixir-P45HOAC7.css" />


    <script src="dist/handlebars.runtime-NWIB6V2M.js"></script>
    <script src="dist/handlebars.templates-K7URE6B4.js"></script>
    <script src="dist/sidebar_items-6B1E8A49.js"></script>
    <script src="docs_config.js"></script>
    <script async src="dist/html-PVRIOB7F.js"></script>

  </head>
  <body data-type="tasks" class="page-task">
    <script>

      try {
        var settings = JSON.parse(localStorage.getItem('ex_doc:settings') || '{}');

        if (settings.theme === 'dark' ||
           ((settings.theme === 'system' || settings.theme == null) &&
             window.matchMedia('(prefers-color-scheme: dark)').matches)
           ) {
          document.body.classList.add('dark')
        }
      } catch (error) { }
    </script>

<div class="body-wrapper">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

        <a href="readme.html" class="sidebar-projectImage">
          <img src="assets/logo.png" alt="Plausible" />
        </a>

      <div>
        <a href="readme.html" class="sidebar-projectName" translate="no">
Plausible
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v0.0.1
        </div>
      </div>
    </div>
    <ul id="sidebar-listNav" class="sidebar-listNav" role="tablist">
      <li>
        <button id="extras-list-tab-button" role="tab" data-type="extras" aria-controls="extras-tab-panel" aria-selected="true" tabindex="0">
Pages
        </button>
      </li>

        <li>
          <button id="modules-list-tab-button" role="tab" data-type="modules" aria-controls="modules-tab-panel" aria-selected="false" tabindex="-1">
            Modules
          </button>
        </li>


        <li>
          <button id="tasks-list-tab-button" role="tab" data-type="tasks" aria-controls="tasks-tab-panel" aria-selected="false" tabindex="-1">
            <span translate="no">Mix</span> Tasks
          </button>
        </li>

    </ul>
  </div>

  <div id="extras-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="extras-list-tab-button">
    <ul id="extras-full-list" class="full-list"></ul>
  </div>

    <div id="modules-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="modules-list-tab-button" hidden>
      <ul id="modules-full-list" class="full-list"></ul>
    </div>


    <div id="tasks-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="tasks-list-tab-button" hidden>
      <ul id="tasks-full-list" class="full-list"></ul>
    </div>

</nav>

<main class="content">
  <output role="status" id="toast"></output>

  <div id="content" class="content-inner">
    <div class="top-search">
      <div class="search-settings">
        <form class="search-bar" action="search.html">
          <label class="search-label">
            <span class="sr-only">Search documentation of Plausible</span>
            <input name="q" type="text" class="search-input" placeholder="Press / to search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
          </label>
          <button type="submit" class="search-button" aria-label="Submit Search">
            <i class="ri-search-2-line ri-lg" aria-hidden="true" title="Submit search"></i>
          </button>
          <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
            <i class="ri-close-line ri-lg" title="Cancel search"></i>
          </button>
        </form>
        <div class="autocomplete">
        </div>
        <button class="icon-settings display-settings">
          <i class="ri-settings-3-line"></i>
          <span class="sr-only">Settings</span>
        </button>
      </div>
    </div>

<div id="top-content">
  <h1>

      <a href="https://github.com/plausible/analytics/blob/main/lib/mix/tasks/create_paddle_prod_plans.ex#L1" title="View Source" class="icon-action" rel="help">
        <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        <span class="sr-only">View Source</span>
      </a>

    <span translate="no">mix create_paddle_prod_plans</span> 
    <small class="app-vsn" translate="no">(Plausible v0.0.1)</small>

  </h1>


    <section id="moduledoc">
<h2 id="module-utility-for-creating-paddle-plans-for-production-use" class="section-heading">
  <a href="#module-utility-for-creating-paddle-plans-for-production-use" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Utility for creating Paddle plans for production use.</span>
</h2>
<p>Takes a single <code class="inline">filename</code> argument which should be of format
<code class="inline">input_plans_v*.json</code>. That file should live in the <code class="inline">/priv</code> directory next
to all other plans and it should contain the necessary information about
the production plans to be created.</p><p>In order to create the input file:</p><ul><li>Copy an existing <code class="inline">plans_v*.json</code> (latest recommended) into the new
<code class="inline">input_plans_v*.json</code> file.</li><li>For every plan object:<ul><li>Adjust the generation, limits, features, etc as desired</li><li>Replace <code class="inline">monthly_product_id</code> with a <code class="inline">monthly_price</code> (integer)</li><li>Replace <code class="inline">yearly_product_id</code> with a <code class="inline">yearly_price</code> (integer)</li></ul></li></ul><p>After this task is finished successfully, the plans will be created in Paddle
with the prices given in the input file. With the creation, every plan gets an
autoincremented ID in Paddle. We will then fetch those exact plans from Paddle
in an API call and use their monthly and yearly product_id's to write
<code class="inline">plans_v*.json</code>. It will be written taking the input file as the &quot;template&quot;
and replacing the monthly/yearly prices with monthly/yearly product_id's.</p><p>The prices will be written into <code class="inline">/priv/plan_prices.json</code> (instead of the
prod plans output file). Note that this separation is intentional - we only
store prices locally to not rely on Paddle in the dev environment. Otherwise,
Paddle is considered the &quot;source of truth&quot; of plan prices.</p><h2 id="module-usage-example" class="section-heading">
  <a href="#module-usage-example" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Usage example:</span>
</h2>
<pre><code class="makeup elixir" translate="no"><span class="n">mix</span><span class="w"> </span><span class="n">create_paddle_prod_plans</span><span class="w"> </span><span class="n">input_plans_v5</span><span class="o">.</span><span class="n">json</span></code></pre><h2 id="module-requirement-1-replace-the-curl-command" class="section-heading">
  <a href="#module-requirement-1-replace-the-curl-command" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Requirement 1: Replace the curl command</span>
</h2>
<p>Unfortunately, there's no API in Paddle that would allow &quot;bulk creating&quot;
plans - it has to be done through the UI. As a hack though, we can automate
the process by copying the curl request with the help of browser devtools.</p><p>Therefore, this Mix.Task <strong>does not work out of the box</strong> and the actual curl
command that it executes must be replaced by the developer. Here's how:</p><ol start="0"><li>Access required to the production Paddle account</li><li>Navigate to <a href="https://vendors.paddle.com/subscriptions/plans">https://vendors.paddle.com/subscriptions/plans</a>. Chrome or
Firefox recommended (need to copy a POST request as cURL in a later step)</li><li>Click the &quot;+ New Plan&quot; button (top right of the screen) to open the form</li><li>Open browser devtools, fill in the required fields and submit the form.
No need to worry about the form fields since they're provided in this task
(except <code class="inline">_token</code>) and they <em>should work</em> as long as nothing has changed.</li><li>Find the POST request from the &quot;Network&quot; tab and copy it as cURL</li><li>Come back here and paste it into the <code class="inline">create_paddle_plan</code> function</li><li>Replace the params within the string with the real params (these should
be available in the function already)</li></ol><h2 id="module-requirement-2-paddle-production-credentials" class="section-heading">
  <a href="#module-requirement-2-paddle-production-credentials" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Requirement 2: Paddle production credentials</span>
</h2>
<p>You also need to obtain the Paddle credentials from prod environment and
replace them into the module attributes. See <code class="inline">@paddle_vendor_id</code> and
<code class="inline">@paddle_vendor_auth_code</code>. Those are needed to fetch the plans via an
actual API call after the plans have been created in Paddle.</p>
    </section>

</div>

  <section id="summary" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#summary">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Summary</span>
    </h1>
<div class="summary-functions summary">
  <h2>
    <a href="#functions">Functions</a>
  </h2>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#curl_quietly/1" data-no-tooltip translate="no">curl_quietly(cmd)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#fetch_all_paddle_plans/4" data-no-tooltip translate="no">fetch_all_paddle_plans(url, paddle_credentials, page \\ 0, fetched \\ 0)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#order_keys/1" data-no-tooltip translate="no">order_keys(plan)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#run/1" data-no-tooltip translate="no">run(list)</a>

      </div>

        <div class="summary-synopsis"><p>Callback implementation for <a href="https://hexdocs.pm/mix/Mix.Task.html#c:run/1"><code class="inline">Mix.Task.run/1</code></a>.</p></div>

    </div>

</div>

  </section>


  <section id="functions" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#functions">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Functions</span>
    </h1>
    <div class="functions-list">
<section class="detail" id="curl_quietly/1">

  <div class="detail-header">
    <a href="#curl_quietly/1" class="detail-link" data-no-tooltip aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <h1 class="signature" translate="no">curl_quietly(cmd)</h1>

      <a href="https://github.com/plausible/analytics/blob/main/lib/mix/tasks/create_paddle_prod_plans.ex#L328" class="icon-action" rel="help" aria-label="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
     </a>


  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="fetch_all_paddle_plans/4">

    <span id="fetch_all_paddle_plans/2"></span>

    <span id="fetch_all_paddle_plans/3"></span>

  <div class="detail-header">
    <a href="#fetch_all_paddle_plans/4" class="detail-link" data-no-tooltip aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <h1 class="signature" translate="no">fetch_all_paddle_plans(url, paddle_credentials, page \\ 0, fetched \\ 0)</h1>

      <a href="https://github.com/plausible/analytics/blob/main/lib/mix/tasks/create_paddle_prod_plans.ex#L211" class="icon-action" rel="help" aria-label="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
     </a>


  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="order_keys/1">

  <div class="detail-header">
    <a href="#order_keys/1" class="detail-link" data-no-tooltip aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <h1 class="signature" translate="no">order_keys(plan)</h1>

      <a href="https://github.com/plausible/analytics/blob/main/lib/mix/tasks/create_paddle_prod_plans.ex#L308" class="icon-action" rel="help" aria-label="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
     </a>


  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="run/1">

  <div class="detail-header">
    <a href="#run/1" class="detail-link" data-no-tooltip aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <h1 class="signature" translate="no">run(list)</h1>

      <a href="https://github.com/plausible/analytics/blob/main/lib/mix/tasks/create_paddle_prod_plans.ex#L73" class="icon-action" rel="help" aria-label="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
     </a>


  </div>

  <section class="docstring">

<p>Callback implementation for <a href="https://hexdocs.pm/mix/Mix.Task.html#c:run/1"><code class="inline">Mix.Task.run/1</code></a>.</p>
  </section>
</section>

    </div>
  </section>

    <footer class="footer">
      <p>

        <span class="line">
          <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
            Search HexDocs
          </button>

            <a href="Plausible.epub" title="ePub version">
              Download ePub version
            </a>

        </span>
      </p>

      <p class="built-using">
        Built using
        <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.35.1) for the

          <a href="https://elixir-lang.org" title="Elixir" target="_blank" translate="no">Elixir programming language</a>

      </p>

    </footer>
  </div>
</main>
</div>
<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<script>mermaid.initialize({startOnLoad: true})</script>

  </body>
</html>
